(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8173],{3249:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>f});var a=t(5155),l=t(1921),r=t(6296),c=t(723),n=t(1958),i=t(1914),d=t(3545),o=t(8368),m=t(1975),x=t(8459),p=t(2484),h=t(8500),g=t.n(h),u=t(2115);function f(){let[e,s]=(0,u.useState)([]),[t,h]=(0,u.useState)([]),[f,b]=(0,u.useState)(!0),[j,y]=(0,u.useState)(!1),[N,w]=(0,u.useState)(null),[v,A]=(0,u.useState)(null),[S,E]=(0,u.useState)(null);(0,u.useEffect)(()=>{T()},[]);let T=async()=>{y(!0);try{let e=await fetch("/api/whatsapp/templates"),t=await e.json();t.success&&(s(t.localTemplates||[]),h(t.metaTemplates||[]),E(t.metaError||null))}catch(e){console.error("Error fetching templates:",e)}finally{b(!1),y(!1)}},k=async(e,t)=>{if(confirm(`Are you sure you want to submit "${t}" to Meta for approval?`)){A(e);try{let t=await fetch(`/api/whatsapp/templates/${e}/submit`,{method:"POST",headers:{"Content-Type":"application/json"}}),a=await t.json();a.success?(alert("Template submitted successfully! It may take some time to appear in Meta templates."),s(s=>s.map(s=>s.id===e?{...s,approved:!0}:s)),T()):alert(a.error||"Failed to submit template")}catch(e){alert("Failed to connect to server")}finally{A(null)}}},C=async(e,t)=>{if(confirm(`Are you sure you want to delete the local template "${t}"?`)){w(e);try{let t=await fetch(`/api/whatsapp/templates/${e}`,{method:"DELETE"}),a=await t.json();a.success?s(s=>s.filter(s=>s.id!==e)):alert(a.error||"Failed to delete template")}catch(e){alert("Failed to connect to server")}finally{w(null)}}};return f?(0,a.jsx)(l.default,{children:(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,a.jsx)(r.A,{className:"w-8 h-8 animate-spin text-purple-600"})})}):(0,a.jsx)(l.default,{children:(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(g(),{href:"/admin/whatsapp",className:"p-2 text-gray-500 hover:text-gray-700 rounded-lg hover:bg-gray-100",children:(0,a.jsx)(c.A,{className:"w-5 h-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:"WhatsApp Templates"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Manage local and Meta-approved templates"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:T,className:"p-2 text-gray-500 hover:text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",title:"Refresh from Meta",children:(0,a.jsx)(n.A,{className:`w-5 h-5 ${j?"animate-spin":""}`})}),(0,a.jsxs)(g(),{href:"/admin/whatsapp/templates/new",className:"flex items-center gap-2 px-4 py-2 text-sm font-semibold text-white bg-green-600 rounded-xl hover:bg-green-700 shadow-sm",children:[(0,a.jsx)(i.A,{className:"w-4 h-4"}),"New Local Template"]})]})]}),S&&(0,a.jsxs)("div",{className:"bg-amber-50 border border-amber-200 rounded-2xl p-4 flex items-start gap-3",children:[(0,a.jsx)(d.A,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-amber-800 text-sm",children:"Meta Sync Issue"}),(0,a.jsxs)("p",{className:"text-xs text-amber-700 mt-1",children:[S,". Showing local templates only. Check your WHATSAPP_API_TOKEN."]})]})]}),(0,a.jsxs)("section",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(o.A,{className:"w-5 h-5 text-purple-600"}),(0,a.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:"Local Drafts"})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:0===e.length?(0,a.jsx)("div",{className:"col-span-full bg-white rounded-2xl border border-gray-100 p-8 text-center text-gray-500 text-sm",children:"No local templates found. Create one to get started."}):e.map(e=>(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 overflow-hidden flex flex-col shadow-sm",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-gray-100 flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 line-clamp-1",children:e.name}),(0,a.jsx)("span",{className:"px-2 py-0.5 text-[10px] font-bold bg-gray-100 text-gray-600 rounded-full uppercase",children:"Local"})]}),(0,a.jsx)("div",{className:"p-4 bg-gray-50 flex-1",children:(0,a.jsx)("p",{className:"text-xs text-gray-600 whitespace-pre-wrap line-clamp-6 font-mono",children:e.content})}),(0,a.jsxs)("div",{className:"p-4 border-t border-gray-100 flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-[10px] text-gray-400 font-medium",children:new Date(e.createdAt).toLocaleDateString()}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[!e.approved&&(0,a.jsxs)("button",{onClick:()=>k(e.id,e.name),disabled:v===e.id,className:"px-2 py-1 text-xs font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors flex items-center gap-1",children:[v===e.id?(0,a.jsx)(r.A,{className:"w-3 h-3 animate-spin"}):(0,a.jsx)(m.A,{className:"w-3 h-3"}),"Submit"]}),(0,a.jsx)("button",{onClick:()=>C(e.id,e.name),disabled:N===e.id,className:"p-1.5 text-gray-400 hover:text-red-600 rounded-md hover:bg-red-50 transition-colors",children:N===e.id?(0,a.jsx)(r.A,{className:"w-4 h-4 animate-spin"}):(0,a.jsx)(x.A,{className:"w-4 h-4"})})]})]})]},e.id))})]}),t.length>0&&(0,a.jsxs)("section",{className:"space-y-4 pt-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(p.A,{className:"w-5 h-5 text-green-600"}),(0,a.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:"Meta Cloud Templates"})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map((e,s)=>(0,a.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-100 overflow-hidden flex flex-col shadow-sm",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-gray-100 flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 line-clamp-1",children:e.name}),(0,a.jsx)("span",{className:`px-2 py-0.5 text-[10px] font-bold rounded-full uppercase ${"APPROVED"===e.status?"bg-green-100 text-green-700":"bg-amber-100 text-amber-700"}`,children:e.status})]}),(0,a.jsxs)("div",{className:"p-4 bg-gray-50 flex-1",children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 uppercase font-bold mb-2",children:e.category}),(0,a.jsx)("p",{className:"text-xs text-gray-600 line-clamp-6",children:e.components.find(e=>"BODY"===e.type)?.text||"No content"})]}),(0,a.jsx)("div",{className:"p-4 border-t border-gray-100",children:(0,a.jsx)("p",{className:"text-[10px] text-gray-400 font-medium",children:"Synced from Meta Cloud API"})})]},`${e.name}-${s}`))})]})]})})}},9991:(e,s,t)=>{Promise.resolve().then(t.bind(t,3249))}},e=>{e.O(0,[8500,2323,1921,8441,3794,7358],()=>e(e.s=9991)),_N_E=e.O()}]);